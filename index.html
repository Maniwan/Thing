<!DOCTYPE html>
<html>
<head>
    <title>Thing</title>
    <style>
        body { margin: 0; overflow: hidden; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/libs/dat.gui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>

    <script>
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        const scene = new THREE.Scene();

        // Camera
        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(0, 2, 5);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        // Light
        scene.add(new THREE.AmbientLight(0x808080));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(20, 20, 50);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 1024;
        dirLight.shadow.mapSize.height = 1024;
        dirLight.shadow.camera.left = -50;
        dirLight.shadow.camera.right = 50;
        dirLight.shadow.camera.top = 50;
        dirLight.shadow.camera.bottom = -50;
        dirLight.shadow.camera.near = 1;
        dirLight.shadow.camera.far = 100;
        scene.add(dirLight);

        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        new THREE.RGBELoader().load(
            'https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/lakeside_sunrise_1k.hdr',
            function (hdrEquirect) {
                const envMap = pmremGenerator.fromEquirectangular(hdrEquirect).texture;
                scene.background = envMap;
                scene.environment = envMap;

                hdrEquirect.dispose();
                pmremGenerator.dispose();
            }
        );

        // GUI for light control
        const gui = new dat.GUI({ width: 600 });
        gui.domElement.style.maxHeight = "500px";
        gui.domElement.style.overflowY = "auto";

        const lightFolder = gui.addFolder('Directional Light');
        lightFolder.add(dirLight, 'intensity', 0, 10, 0.01).name('Intensity');
        lightFolder.add(dirLight.position, 'x', -100, 100, 0.1).name('Position X');
        lightFolder.add(dirLight.position, 'y', 0, 100, 0.1).name('Position Y');
        lightFolder.add(dirLight.position, 'z', -100, 100, 0.1).name('Position Z');
        lightFolder.open();

        const groundTexture = new THREE.TextureLoader().load(
            'https://Maniwan.github.io/Thing/BarkPoplar001_COL_2K.jpg'
        );
        groundTexture.wrapS = THREE.RepeatWrapping;
        groundTexture.wrapT = THREE.RepeatWrapping;
        groundTexture.repeat.set(8, 8);

        // Create ground plane
        const groundGeo = new THREE.PlaneGeometry(50, 50);
        const groundMat = new THREE.MeshStandardMaterial({
            map: groundTexture,
            roughness: 0.8,
            metalness: 0.2
        });

        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = 0;
        ground.receiveShadow = true;
        scene.add(ground);

        // Box
        const boxGeometry = new THREE.BoxGeometry(1, 2, 0.5);
        const boxMaterial = new THREE.MeshStandardMaterial({
            color: 0x00ff00,
            metalness: 0.5,
            roughness: 0.5
        });
        const boxMesh = new THREE.Mesh(boxGeometry, boxMaterial);
        boxMesh.position.set(5, 1, 0);
        boxMesh.castShadow = true;
        boxMesh.receiveShadow = true;
        scene.add(boxMesh);

        // GUI for box
        const boxFolder = gui.addFolder('Box Material');
        boxFolder.addColor({ color: boxMaterial.color.getHex() }, 'color')
            .name('Color')
            .onChange(value => {
                boxMaterial.color.set(value);
            });
        boxFolder.add(boxMaterial, 'metalness', 0, 1, 0.01).name('Metalness');
        boxFolder.add(boxMaterial, 'roughness', 0, 1, 0.01).name('Roughness');
        boxFolder.open();

        // Load textures
        const texLoader = new THREE.TextureLoader();
        const texList = [
            texLoader.load("https://Maniwan.github.io/Thing/DESSOUS_Base_color.png"),
            texLoader.load("https://Maniwan.github.io/Thing/DESSOUS_Normal_OpenGL.png"),
            texLoader.load("https://Maniwan.github.io/Thing/DESSOUS_Roughness@channels=B.png"),
            texLoader.load("https://Maniwan.github.io/Thing/DESSOUS_Roughness@channels=G.png"),
            texLoader.load("https://Maniwan.github.io/Thing/DESSUS_Base_color.png"),
            texLoader.load("https://Maniwan.github.io/Thing/DESSUS_Normal_OpenGL.png"),
            texLoader.load("https://Maniwan.github.io/Thing/DESSUS_Roughness@channels=B.png"),
            texLoader.load("https://Maniwan.github.io/Thing/DESSUS_Roughness@channels=G.png"),
            texLoader.load("https://Maniwan.github.io/Thing/ONGLES_Base_color.png"),
            texLoader.load("https://Maniwan.github.io/Thing/ONGLES_Normal_OpenGL.png"),
            texLoader.load("https://Maniwan.github.io/Thing/ONGLES_Roughness@channels=B.png"),
            texLoader.load("https://Maniwan.github.io/Thing/ONGLES_Roughness@channels=G.png")
        ];

        let modelObject = null;
        let moveForward = false;

        // Load OBJ
        const loader = new THREE.OBJLoader();
        loader.load("https://Maniwan.github.io/Thing/Sketchfab_2022_12_28_11_35_51.obj", (object) => {
            let i = 0;
            object.traverse((child) => {
                if (child.isMesh) {
                    child.castShadow = true;
                    child.receiveShadow = true;

                    child.material = new THREE.MeshStandardMaterial({
                        map: texList[0],
                        metalnessMap: texList[3],
                        roughnessMap: texList[2],
                        normalMap: texList[5],
                        metalness: 0.03,
                        roughness: 0.03
                    });

                    i++;
                }
            });
            modelObject = object;
            scene.add(object);
        });

        // Mouse controls
        window.addEventListener('mousedown', () => {
            moveForward = true;
        });
        window.addEventListener('mouseup', () => {
            moveForward = false;
        });

        // Render loop
        function animate() {
            if (modelObject && moveForward) {
                modelObject.position.z -= 0.05;
            }
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
